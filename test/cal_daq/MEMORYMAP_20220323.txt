<TCB memory map>
-------------------------------------------------------------------------------
Address			Register			
-------------------------------------------------------------------------------
0x00		Reset timer/Reset/Start/Stop/Start DRS/stop DRS	[5:0]
-------------------------------------------------------------------------------
0x01~02		Link status					R
-------------------------------------------------------------------------------
0x03~2A		Module MID					R
-------------------------------------------------------------------------------
0x2B		Coincidence width				[7:0]
-------------------------------------------------------------------------------
0x2C		x						x
-------------------------------------------------------------------------------
0x2D		Software trigger				W
-------------------------------------------------------------------------------
0x2E		Pedestal trigger interval			[15:0]
-------------------------------------------------------------------------------
0x2F		Trigger enable					[3:0]
-------------------------------------------------------------------------------
0x30		Multiplicity threshold				[10:0]
-------------------------------------------------------------------------------


<DAQ memory map>
* channel offset = ch * 0x100
========================================================
ADDRESS		CONTENTS	
========================================================
0x01		coincidence width		[3:0]
--------------------------------------------------------
0x02		high voltage			c[7:0]
--------------------------------------------------------
0x03		threshold			c[11:0]
--------------------------------------------------------
0x04		temperature			c[11:0]
--------------------------------------------------------
0x05		DRS PLL locked			[3:0]
--------------------------------------------------------
0x06		DRAM on/off			[0]
--------------------------------------------------------
0x07		test DRAM 			[31:0]
--------------------------------------------------------
0x08		Multiplicity threshold		[5:0]
--------------------------------------------------------
0x09		Trigger delay			[3:0]
--------------------------------------------------------
0x0A		Trigger latency			[7:0]
--------------------------------------------------------
0x0B		Run number			[15:0]
--------------------------------------------------------
0x20		DRS_ofs				[27:16][11:0]
--------------------------------------------------------
0x21		DRS calibration 		[0]
--------------------------------------------------------
0x22		ADC setup/adc alignment		[15:0]
--------------------------------------------------------
0x23		DRAM delay calibration		x
--------------------------------------------------------
0x24		DRAM delay			c[4:0]
--------------------------------------------------------
0x25		send DRAM bitslip		x
========================================================


<DAQ data readout memory map>
========================================================
ADDRESS		CONTENTS	
========================================================
0x00000000	Data size			[18:0]
--------------------------------------------------------
0x00000001	Run status			[0]
--------------------------------------------------------
0x40000000	Waveform data 			[31:0]
========================================================


<Data format>
========================================================
header(64 byte)
--------------------------------------------------------
data length = 65536				4 byte
--------------------------------------------------------
run number					2 byte
--------------------------------------------------------
trigger type					1 byte
--------------------------------------------------------
TCB trigger number				4 byte
--------------------------------------------------------
trigger fine time				1 byte
--------------------------------------------------------
trigger coarse time				6 byte
--------------------------------------------------------
module id					1 byte
--------------------------------------------------------
local trigger number				4 byte
--------------------------------------------------------
local trigger pattern				4 byte
--------------------------------------------------------
DRS stop fine time				1 byte
--------------------------------------------------------
DRS stop coarse time				6 byte
--------------------------------------------------------
reserved(0s)					30 byte				
========================================================
ADC sample(64 byte/sample)
--------------------------------------------------------
ch1 data					2 byte
--------------------------------------------------------
........					......
--------------------------------------------------------
ch32 data					2 byte
========================================================
* Trigger pattern is captured @ stopping DRS
  (Disctiminator input makes 200 ns width pulse)
* Trigger pattern
  1 = self trigger
  2 = pedestal trigger
  4 = software trigger
  8 = external trigger
  0 = DRS is stopped at TCB trigger, no trigger


<Trigger>
1. DAQ stops DRS chip at local trigger
2. DAQ sends local trigger information to TCB
3. TCB decides global trigger
4. TCB sends global trigger information to DAQ
5. DAQ starts digitization if it accepts global trigger
   within programmed time interval,
   otherwise DAQ rerun DRS chip.


<TCB>
* 90 MHz, 8b10b

(1) Timer
    K28.1(1) -> Command(1) -> Coarse time(6) -> Sync(1)

(2) TCB read/write
    K28.1(1) -> MID(1) -> Address(2) -> Data(4) -> Sync(1)

(3) DAQ response
    K28.1(1) -> MID(1) -> Type(1) -> Data(4) -> Sync(2)

(4) TCB trigger
    K28.5(10)-> Type(2) -> Fine time(7) -> Coarse time(48) -> Trigger#(32)

(5) DAQ trigger
    K28.5(10)->Hit pattern(32, LSB fisrt)

* Address = com[2] & addr[14], com : 01 = write, 11 = read
** Type : 0x01 = write, 0x03 = read
*** TCB trigger packet = 1100 ns
**** DAQ trigger packet = 467 ns
***** Minumim trigger latency = 2 us roughly
 









